# Задание 3. Исправление ошибок в Работе плагина для VS-Code

1) При первом запуске компилятор вернул ошибки "type 'string' is not assignable" и "property 'loc' does not exist"
   - из деклараций объектов определил корректные параметры: textDocumentSync: 1 и property.loc

2) после запуска плагина, в окне превью отобразилось  {{content}}
   - нашел эту переменную шаблонизатора в файле index.html
   - через поиск файлов, использующих index.html нашел src/extension.ts
   - обратил внимание на регулятное выражение, использующееся для заполнения переменных html-шаблона
   - установил пробельные символы необязательными, заменив \s+ на \s*

3) {{content}} из превью ушло, но блоки не появились :(
   - подменой значения переменной html понял что проблема в стилях, а не в контенте или разметке
   - в style.css заметил не корректные селекторы по классу ".div" вместо тега "div" - пофиксил, но блоки не появились :(
   - перенес стили внутрь html-файла - блоки появились! Значит проблема в подключении css
   - потерял массу времени на различные комбинации путей и значений uri-sсheme... и, перейдя к изучению параметров createWebviewPanel наткнулся на WebviewOptions и описание localResourceRoots, где упояналась vscode-resource: scheme ))

4) Перешел к фиксам линтинга... Пришлось использовать линтер-заглушку, т.к. после здачи Задания №1, до закрытия приема заявок оставался всего 1 день, и по опыту заданий ШРИ 2018, решил Задание №2 пропустить, перейдя сразу к Заданию №3 (теперь понимаю что зря...)
   - перечитав задание, нашел настройки расширения и включил линтер
   - сдвинулся с мертвой точки, обратив внимание на OUTPUT Language Server Example, где сыпались ошибки парсинга "SyntaxError: Unexpected symbol <f> at 1:1 file:///.../pages/index.json"
   - обнаружил, что линтер пытается parseJson(json: string), а там путь к файлу вместо содержимого!
   - проанализировав код server.ts, решил реализовать чтение файла: добавил импорт функции чтения из файла, и пофиксил const json = readFileSync(source).toString()

5) ошибки из консоли ушли, но нарушений правил линтер не подсвечивает... console.info(errors) внутри makeLint показывает пустой массив (
   - ставил логи в функции validateObject, walk и т.п. - везде был корректный результат...
   - наконец обратил внимание на спецификации interface Array<T>, где стало понятно, что errors.concat - данный метод подменяет своим содеримым исходный массив, тогда как для сбора ошибок явно необходим метод errors.push !

6) подсветка и описание ошибок появилось, но работает не корректно: при редактировании файла, читает как будто с опозданием на одно действие, а после исправления ошибки - подстветка и сообщение не исчезают... видимо решение с чтением файла не совсем верное (
   - понял, что читать файл из директории его сохранения (решение принятое на шаге 4) - не подходит, т.к. линтер должен находит ошибки "налету" не дожидаясь записи файла на диск
   - ознакомился и декларацией на объект TextDocument и понял что все необходимое уже было под рукой! испоьзовал метод textDocument.getText()!

7) Осталось решить проблему обновления результатов диагностики (подсветку и список проблем) при исполнении рекомендаций линтера
